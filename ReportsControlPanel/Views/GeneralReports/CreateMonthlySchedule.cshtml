@using System.Globalization
@using AnalitFramefork.Mvc
@using Microsoft.Win32.TaskScheduler
@using ReportsControlPanel.Models

@{
	MonthlySchedule monthlySchedule = ViewBag.MonthlySchedule;
	GeneralReport generalReport = ViewBag.GeneralReport;
	BaseController controller = ViewBag.Controller;
	var months = Enum.GetNames(typeof(MonthsOfTheYear)).ToList();
	monthlySchedule.GeneralReport = generalReport;
}

<div class="panel panel-primary">
	<div class="panel-body">
		<div class="col-md-12">
			@using (@Html.BeginForm(null, null, FormMethod.Post, new { @class = "form-horizontal" }))
			{
				@Html.Hidden("scheduleId", monthlySchedule.Id)
				@Html.HiddenFor(i => monthlySchedule.Id)
				@Html.HiddenFor(i => monthlySchedule.GeneralReport.Id)
				<div class="form-group ">
					<label class="col-sm-1 control-label">Время</label>
					<div class="col-sm-2">
						@Html.TextBoxFor(i => monthlySchedule.Hour, new { @class = "form-control form" })
					</div>
					<div class="pull-left">:</div>
					<div class="col-sm-2">
						@Html.TextBoxFor(i => monthlySchedule.Minute, new { @class = "form-control form" })
					</div>
				</div>
				<div>
					@ViewBag.Validation.GetError(monthlySchedule, "Hour")
					@ViewBag.Validation.GetError(monthlySchedule, "Minute")
				</div>
				<div class="form-group ">
					<label class="col-sm-1 control-label">Месяца</label>
					<div class="col-sm-9">
						@for (var i = 0; i < months.Count; i++)
						{
							if (i >= 12)
							{
								break;
							}

							var month = (MonthsOfTheYear) Enum.Parse(typeof (MonthsOfTheYear), months[i]);
							var checkd = monthlySchedule.Months.Contains(month) ? "checked='checked'" : "";
							<input type='checkbox' name="monthlySchedule.Months[@i].Value" @checkd value="@month"/>
							<span>@DateTimeFormatInfo.CurrentInfo.GetMonthName(i + 1)</span>
						}
					</div>
				</div>
			<div class="form-group ">
					<label class="col-sm-1 control-label">Дни</label>
					<div class="col-sm-9">
						@for (var i = 1; i <= 31; i++)
						{
							var checkd = monthlySchedule.Days.Contains(i) ? "checked='checked'" : "";
							<input type='checkbox' name="monthlySchedule.Days[@i].Value" @checkd value="@i" />
							<span>@i</span>
						}
					</div>
				</div>
				<div class="form-group ">
					<button class="btn btn-green" type="submit">@controller.IfEdit("Изменить", "Сохранить")</button>
				</div>
			}
		</div>
	</div>
</div>

<div class="form-group">
	<a class="btn btn-blue" href="@Url.Action("Schedule",new {id = generalReport.Id})">
		Назад
	</a>
</div>

